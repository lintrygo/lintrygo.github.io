<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.7.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="stay hungry stay foolish">
<meta property="og:type" content="website">
<meta property="og:title" content="WuHao">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="WuHao">
<meta property="og:description" content="stay hungry stay foolish">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WuHao">
<meta name="twitter:description" content="stay hungry stay foolish">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>WuHao</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">WuHao</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/04/14/go和java对比（基本语法）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/image01.jpg">
      <meta itemprop="name" content="zhengwuhao">
      <meta itemprop="description" content="stay hungry stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WuHao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/14/go和java对比（基本语法）/" class="post-title-link" itemprop="url">go和Java对比（基本语法）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-04-14 22:06:22 / 修改时间：18:49:12" itemprop="dateCreated datePublished" datetime="2024-04-14T22:06:22+08:00">2024-04-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一-、基础语法"><a href="#一-、基础语法" class="headerlink" title="一 、基础语法"></a>一 、基础语法</h2><p>Golang: 编码风格及可见域规则严格且简单；Java: 来说层次接口清晰、规范</p>
<h3 id="1、变量"><a href="#1、变量" class="headerlink" title="1、变量"></a>1、变量</h3><h4 id="a、变量声明及使用"><a href="#a、变量声明及使用" class="headerlink" title="a、变量声明及使用"></a>a、变量声明及使用</h4><p>在Java中：变量可以声明了却不使用</p>
<pre><code>public static String toString(int num) { 
    int data = num; 
    return String.valueOf(num); 
} 
</code></pre><p>Golang中：声明的变量必须被使用（否则会编译报错），否则需要使用_来替代掉变量名，表明该变量不会使用到</p>
<pre><code>func toString(num int) string {
    data := num     // data没有使用者，无法编译
    return num
}

func toString(num int) string {
    _ := num          // 正常编译
    return num
}
</code></pre><h4 id="b、变量声明及初始化"><a href="#b、变量声明及初始化" class="headerlink" title="b、变量声明及初始化"></a>b、变量声明及初始化</h4><p>在Java中：如果在方法内部声明一个变量但不初始化，在使用时会出现编译错误；</p>
<pre><code>public void compareVariable() {
        int age;
        Object object;
        System.out.println(age); // 编译错误
        System.out.println(object); // 编译错误
}
</code></pre><p>在Golang中：对于基本类型来讲，声明即初始化，默认为0;对于引用类型，声明则初始化为nil。</p>
<pre><code>func compareVariable() {
    var age int
    var hashMap *map[string]int
    fmt.Println(num) // num = 0
    fmt.Println(hashMap) //  &amp;hashMap== nil
}。
</code></pre><h3 id="2、作用域规则"><a href="#2、作用域规则" class="headerlink" title="2、作用域规则"></a>2、作用域规则</h3><p>Java: 对方法、变量及类的可见域规则是通过private、protected、public关键字来控制的</p>
<p>Golang: 控制可见域的方式只有一个，当字段首字母开头是大写时说明其是对外可见的、小写时只对包内成员可见。</p>
<h3 id="3、逗号-ok-模式"><a href="#3、逗号-ok-模式" class="headerlink" title="3、逗号 ok 模式"></a>3、逗号 ok 模式</h3><p>在使用Golang编写代码的过程中，许多方法经常在一个表达式返回2个参数时使用这种模式：,ok，第一个参数是一个值或者nil，第二个参数是true/false或者一个错误error。在一个需要赋值的if条件语句中，使用这种模式去检测第二个参数值会让代码显得优雅简洁。这种模式在Golang编码规范中非常重要。这是Golang自身的函数多返回值特性的体现。例如：</p>
<pre><code>if _, ok := conditionMap[&quot;page&quot;]; ok {
      //
} 
</code></pre><h3 id="4、结构体、函数以及方法"><a href="#4、结构体、函数以及方法" class="headerlink" title="4、结构体、函数以及方法"></a>4、结构体、函数以及方法</h3><h4 id="a、结构体声明及使用"><a href="#a、结构体声明及使用" class="headerlink" title="a、结构体声明及使用"></a>a、结构体声明及使用</h4><p>在Golang中区别与Java最显著的一点是，Golang不存在“类”这个概念，组织数据实体的结构在Golang中被称为结构体。函数可以脱离“类”而存在，函数可以依赖于结构体来调用或者依赖于包名调用。Golang中的结构体放弃了继承、实现等多态概念，结构体之间可使用组合来达到复用方法或者字段的效果</p>
<p>Golang 声明一个结构体并使用：</p>
<pre><code>// User  定义User结构体
type User struct {
    Name string
    Age  int
}

// 使用一个结构体
func main() {
    personPoint := new(User) // 通过new方法创建结构体指针
    person1 := User{}        // 通过Person{}创建默认字段的结构体
    person2 := User{
        Name: &quot;zwh5&quot;,
        Age:  zwh5,
    }
    fmt.Println(personPoint) // &amp;{ 0 }
    fmt.Println(person1)     // { 0 }
    fmt.Println(person2)     // {xiaoHong 21 }
}
</code></pre><p>Java声明实体并使用：</p>
<pre><code>class User {
    private String name;
    private int age;

    public User(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public void setName(String name) {
        this.name = name;
    }
    public void setAge(int age) {
        this.age = age;
    }
    public String getName() {
        return name;
    }
    public int getAge() {
        return age;
    }
    public String print() {
        return &quot;{name = &quot; + name + &quot;,age = &quot; + age + &quot;}&quot;;
    }
}

public class Demo {
    public static void main(String[] args) {
        User user = new User(&quot;zwh5&quot;, 28);
        System.out.println(&quot;user信息：&quot; + user.print());   
    }
}
//执行结果
user信息：{name = zwh5,age = 28}
</code></pre><h4 id="b、函数和方法的区别"><a href="#b、函数和方法的区别" class="headerlink" title="b、函数和方法的区别"></a>b、函数和方法的区别</h4><p>在Java中：所有的“函数”都是基于“类”这个概念构建的，也就是只有在“类”中才会包含所谓的“函数”，这里的“函数”被称为“方法”，可见上方声明实体并使用。</p>
<p>在Golang中：“函数”和“方法”的最基本区别是：函数不基于结构体而是基于包名调用，方法基于结构体调用。如下实例：</p>
<pre><code>package entity

import &quot;fmt&quot;

type User struct {
    Name string
    Age  int
}

// User结构体/指针可调用的&quot;方法&quot;，属于User结构体
func (user *User) Solve() {
    fmt.Println(user)
}

// 任何地方都可调用的&quot;函数&quot;，不属于任何结构体，可通过entity.Solve调用
func Solve(user *User) {
    fmt.Println(user)
}


func main() {
    userPoint := new(entity.User) // 通过new方法创建结构体指针
    entity.Solve(userPoint) // 函数调用
    userPoint.Solve()       // 方法调用
}
</code></pre><h3 id="5、值类型、引用类型以及指针"><a href="#5、值类型、引用类型以及指针" class="headerlink" title="5、值类型、引用类型以及指针"></a>5、值类型、引用类型以及指针</h3><p>Java：在Java中不存在显式的指针操作；8种基本数据类型是值类型，数组和对象属于引用类型。<br>Golang：而Golang中存在显式的指针操作，但是Golang的指针不像C那么复杂，不能进行指针运算；所有的基本类型都属于值类型，但是有几个类型比较特殊，表现出引用类型的特征，分别是slice、map、channel、interface，除赋值以外它们都可以当做引用类型来使用，因此当我们这样做时,可以直接使用变量本身而不用指针。<br>注：slice与数组的区别为是否有固定长度，slice无固定长度，数组有固定长度。值得注意的是，在Golang中，只有同长度、同类型的数组才可视为“同一类型”，譬如[]int和[3]int则会被视为不同的类型，这在参数传递的时候会造成编译错误。</p>
<h4 id="a、数组对比"><a href="#a、数组对比" class="headerlink" title="a、数组对比"></a>a、数组对比</h4><p>在Java中：当向方法中传递数组时，可以直接通过该传入的数组修改原数组内部值（浅拷贝）。<br>在Golang中：则有两种情况：在不限定数组长度(为slice)时也直接改变原数组的值，当限定数组长度时会完全复制出一份副本来进行修改（深拷贝）：</p>
<p>Java的数组实践:</p>
<pre><code>public static void main(String[] args) {
        int[] array = {1, 2, 3};
        change(array);
        System.out.println(Arrays.toString(array)); // -1,2,3
    }

    private static void change(int[] array) {
        array[0] = -1;
    }
</code></pre><p>Golang的数组实践:</p>
<pre><code>//  不限定长度（即slice）:
func main() {
    var array = []int{1, 2, 3}
    change(array)
    fmt.Println(array)    // [-1 2 3]
}

func change(array []int) {
    array[0] = -1
}
</code></pre><!---->
<pre><code>//  限定长度（即数组）： 
func main() {
    var array = [3]int{1, 2, 3}
    change(array)
    fmt.Println(array)    //[1 2 3]
}

func change(array [3]int) {
    array[0] = -1
} 
</code></pre><h3 id="b、对象对比"><a href="#b、对象对比" class="headerlink" title="b、对象对比"></a>b、对象对比</h3><p>在Golang中：传入函数参数的是原对象的一个全新的copy（有自己的内存地址）;go对象之间赋值是把对象内存的 内容（字段值等） copy过去，所以才会看到globalUser修改前后的地址不变，但是对象的内容变了。<br>在Java中：传入函数参数的是原对象的引用的copy（指向的是同样的内存地址）; Java对象之间的赋值是把对象的引用 copy过去，因为引用指向的地址变了，所以对象的内容也变了。</p>
<p>Golang的对象实践：</p>
<pre><code>//User 定义User结构体
type User struct {
   Name string
   Age int
}

// 定义一个全局的User
var globalUser = User {
   &quot;xiaoming&quot;,
   28,
}

// modifyUser 定义一个函数，参数为User结构体“对象”，将全局globalUser指向传递过来的User结构体“对象”
func modifyUser(user User) {
   fmt.Printf(&quot;参数user的地址 = %p\n&quot;,&amp;user) 
   fmt.Printf(&quot;globalUser修改前的地址 = %p\n&quot;,&amp;globalUser)
   fmt.Println(&quot;globalUser修改前 = &quot;,globalUser)
   // 修改指向
   globalUser = user
   fmt.Printf(&quot;globalUser修改后的地址 = %p\n&quot;,&amp;globalUser)
   fmt.Println(&quot;globalUser修改后 = &quot;,globalUser)
}

func main() {
   var u User = User {
      &quot;xiaohong&quot;,
      29,
   }
   fmt.Printf(&quot;将要传递的参数u的地址 = %p\n&quot;,&amp;u)
   modifyUser(u)
}

// 执行结果
将要传递的参数u的地址 = 0xc0000ac018
参数user的地址 = 0xc0000ac030
globalUser修改前的地址 = 0x113a270
globalUser修改前 = {xiaoming 28}
globalUser修改后的地址 = 0x113a270
globalUuser修改后 = {xiaohong 29}
</code></pre><p>Java的对象实践验证：</p>
<pre><code>class User {
    private String name;
    private int age;

    public User(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public void setName(String name) {
        this.name = name;
    }
    public void setAge(int age) {
        this.age = age;
    }
    public String getName() {
        return name;
    }
    public int getAge() {
        return age;
    }
    public String print() {
        return &quot;{name = &quot; + name + &quot;,age = &quot; + age + &quot;}&quot;;
    }
}

public class Demo {
    private static User globalUser = new User(&quot;xiaoming&quot;,28);
    public static void modifyUser(User user) {
        System.out.println(&quot;参数globalUser的地址 = &quot; + user);
        System.out.println(&quot;globalUser修改前的地址 = &quot; + globalUser);
        System.out.println(&quot;globalUser修改前 = &quot; + globalUser.print());
        globalUser = user;
        System.out.println(&quot;globalUser修改后的地址 = &quot; + globalUser);
        System.out.println(&quot;globalUser修改后 = &quot; + globalUser.print());
    }
    public static void main(String[] args) {
        User user = new User(&quot;xiaohong&quot;, 29);
        System.out.println(&quot;将要传递的参数user的地址 = &quot; + user);
        modifyUser(user);
    }
}

//执行结果
将要传递的参数user的地址 = com.example.demo.User@5abca1e0
参数globalUser的地址 = com.example.demo.User@5abca1e0
globalUser修改前的地址 = com.example.demo.User@2286778
globalUser修改前 = {name = xiaoming,age = 28}
globalUser修改后的地址 = com.example.demo.User@5abca1e0
globalUser修改后 = {name = xiaohong,age = 29}
</code></pre><h4 id="c、指针的区别"><a href="#c、指针的区别" class="headerlink" title="c、指针的区别"></a>c、指针的区别</h4><p>在Java中：如果传递了引用类型（对象、数组等）会复制其指针进行传递<br>在Golang中：必须要显式传递Person的指针，不然只是传递了该对象的一个副本。</p>
<p>Golang的指针：</p>
<pre><code>// User  定义User结构体
type User struct {
    Name string
    Age  int
}

func main() {
    p1 := User{
        Name: &quot;xiaohong&quot;,
        Age:  21,
    }
    changePerson(p1)
    fmt.Println(p1.Name) // xiaohong
    changePersonByPointer(&amp;p1)
    fmt.Println(p1.Name) // xiaoming
}

func changePersonByPointer(user *User) {
    user.Name = &quot;xiaoming&quot;
}

func changePerson(user User) {
    user.Name = &quot;xiaoming&quot;
}
</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/04/14/gorm基础学习(一)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/image01.jpg">
      <meta itemprop="name" content="zhengwuhao">
      <meta itemprop="description" content="stay hungry stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WuHao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/14/gorm基础学习(一)/" class="post-title-link" itemprop="url">gorm基础学习(一)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-04-14 20:18:45 / 修改时间：18:50:54" itemprop="dateCreated datePublished" datetime="2024-04-14T20:18:45+08:00">2024-04-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Gorm-介绍与安装"><a href="#Gorm-介绍与安装" class="headerlink" title="Gorm 介绍与安装"></a>Gorm 介绍与安装</h1><p>Gorm是一款用于Golang的ORM框架，它提供了丰富的功能，包括模型定义、数据验证、关联查询等。Gorm的设计目标是简洁而强大，使得开发者能够更轻松地进行数据库操作。</p>
<p>一些Gorm的特性包括：</p>
<ol>
<li>模型定义和操作：</li>
</ol>
<ul>
<li>全功能 ORM</li>
<li>关联 (Has One，Has Many，Belongs To，Many To Many，多态，单表继承)<br>Create，Save，Update，Delete，Find 中的钩子方法</li>
<li>支持 Preload、Joins 的预加载</li>
<li>批量插入，FindInBatches，Find/Create with Map，使用 SQL 表达式、Context Valuer 进行 CRUD</li>
<li>复合主键，索引，约束</li>
</ul>
<ol start="2">
<li>事务处理和数据库操作：</li>
</ol>
<ul>
<li>事务，嵌套事务，Save Point，Rollback To Saved Point</li>
<li>Context、预编译模式、DryRun 模式</li>
<li>SQL 构建器，Upsert，数据库锁，Optimizer/Index/Comment Hint，命名参数，子查询</li>
<li>Auto Migration</li>
</ul>
<ol start="3">
<li>其他功能：</li>
</ol>
<ul>
<li>自定义 Logger</li>
<li>灵活的可扩展插件 API：Database Resolver（多数据库，读写分离）、Prometheus…</li>
<li>每个特性都经过了测试的重重考验</li>
<li>开发者友好</li>
</ul>
<p>最新版本2.x，比1.x有较大改动，注意:Gorm最新地址为<a href="https://github.com/go-gorm/gorm，之前https://github.com/jinzhu/gorm地址为v1旧版本" target="_blank" rel="noopener">https://github.com/go-gorm/gorm，之前https://github.com/jinzhu/gorm地址为v1旧版本</a></p>
<h1 id="Gorm-连接数据库"><a href="#Gorm-连接数据库" class="headerlink" title="Gorm 连接数据库"></a>Gorm 连接数据库</h1><h2 id="快速连接-MySQL"><a href="#快速连接-MySQL" class="headerlink" title="快速连接 MySQL"></a>快速连接 MySQL</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;gorm.io/driver/mysql&quot;</span><br><span class="line">	&quot;gorm.io/gorm&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type Product struct &#123;</span><br><span class="line">	gorm.Model</span><br><span class="line">	Code  string</span><br><span class="line">	Price uint</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	dsn := &quot;root:123456@tcp(127.0.0.1:3306)/demo?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><br><span class="line">	db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(&quot;failed to connect database&quot;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 迁移 schema</span><br><span class="line">	db.AutoMigrate(&amp;Product&#123;&#125;)</span><br><span class="line"></span><br><span class="line">	// Create</span><br><span class="line">	db.Create(&amp;Product&#123;Code: &quot;D42&quot;, Price: 100&#125;)</span><br><span class="line"></span><br><span class="line">	// Read</span><br><span class="line">	var product Product</span><br><span class="line">	db.First(&amp;product, 1)                 // 根据整型主键查找</span><br><span class="line">	db.First(&amp;product, &quot;code = ?&quot;, &quot;D42&quot;) // 查找 code 字段值为 D42 的记录</span><br><span class="line"></span><br><span class="line">	// Update - 将 product 的 price 更新为 200</span><br><span class="line">	db.Model(&amp;product).Update(&quot;Price&quot;, 200)</span><br><span class="line">	// Update - 更新多个字段</span><br><span class="line">	db.Model(&amp;product).Updates(Product&#123;Price: 200, Code: &quot;F42&quot;&#125;) // 仅更新非零值字段</span><br><span class="line">	db.Model(&amp;product).Updates(map[string]interface&#123;&#125;&#123;&quot;Price&quot;: 200, &quot;Code&quot;: &quot;F42&quot;&#125;)</span><br><span class="line"></span><br><span class="line">	// Delete - 删除 product</span><br><span class="line">	db.Delete(&amp;product, 1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="MySQL数据库配置解析"><a href="#MySQL数据库配置解析" class="headerlink" title="MySQL数据库配置解析"></a>MySQL数据库配置解析</h2><h2 id="自定义-MySQL-驱动"><a href="#自定义-MySQL-驱动" class="headerlink" title="自定义 MySQL 驱动"></a>自定义 MySQL 驱动</h2><p>GORM 允许通过 DriverName 选项自定义 MySQL 驱动，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	_ &quot;example.com/my_mysql_driver&quot;</span><br><span class="line">	&quot;gorm.io/driver/mysql&quot;</span><br><span class="line">	&quot;gorm.io/gorm&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	db, err := gorm.Open(mysql.New(mysql.Config&#123;</span><br><span class="line">		DriverName: &quot;my_mysql_driver&quot;,</span><br><span class="line">		DSN:        &quot;gorm:gorm@tcp(localhost:9910)/gorm?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;, // data source name, 详情参考：https://github.com/go-sql-driver/mysql#dsn-data-source-name</span><br><span class="line">	&#125;), &amp;gorm.Config&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="现有的数据库连接mysql"><a href="#现有的数据库连接mysql" class="headerlink" title="现有的数据库连接mysql"></a>现有的数据库连接mysql</h2><p>GORM 允许通过一个现有的数据库连接来初始化 *gorm.DB</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import (</span><br><span class="line">	&quot;database/sql&quot;</span><br><span class="line">	&quot;gorm.io/driver/mysql&quot;</span><br><span class="line">	&quot;gorm.io/gorm&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	sqlDB, err := sql.Open(&quot;mysql&quot;, &quot;mydb_dsn&quot;)</span><br><span class="line">	gormDB, err := gorm.Open(mysql.New(mysql.Config&#123;</span><br><span class="line">		Conn: sqlDB,</span><br><span class="line">	&#125;), &amp;gorm.Config&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="现有的数据库连接mysql-1"><a href="#现有的数据库连接mysql-1" class="headerlink" title="现有的数据库连接mysql"></a>现有的数据库连接mysql</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import (</span><br><span class="line">	&quot;database/sql&quot;</span><br><span class="line">	&quot;gorm.io/driver/mysql&quot;</span><br><span class="line">	&quot;gorm.io/gorm&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	sqlDB, err := sql.Open(&quot;mysql&quot;, &quot;mydb_dsn&quot;)</span><br><span class="line">	gormDB, err := gorm.Open(mysql.New(mysql.Config&#123;</span><br><span class="line">		Conn: sqlDB,</span><br><span class="line">	&#125;), &amp;gorm.Config&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="连接池"><a href="#连接池" class="headerlink" title="连接池"></a>连接池</h2><p>GORM 使用 database/sql 来维护连接池</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqlDB, err := db.DB()</span><br><span class="line"></span><br><span class="line">// SetMaxIdleConns sets the maximum number of connections in the idle connection pool.</span><br><span class="line">sqlDB.SetMaxIdleConns(10)</span><br><span class="line"></span><br><span class="line">// SetMaxOpenConns sets the maximum number of open connections to the database.</span><br><span class="line">sqlDB.SetMaxOpenConns(100)</span><br><span class="line"></span><br><span class="line">// SetConnMaxLifetime sets the maximum amount of time a connection may be reused.</span><br><span class="line">sqlDB.SetConnMaxLifetime(time.Hour)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/04/14/gin基础学习（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/image01.jpg">
      <meta itemprop="name" content="zhengwuhao">
      <meta itemprop="description" content="stay hungry stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WuHao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/14/gin基础学习（一）/" class="post-title-link" itemprop="url">gin基础学习(一)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-04-14 18:11:15 / 修改时间：18:48:20" itemprop="dateCreated datePublished" datetime="2024-04-14T18:11:15+08:00">2024-04-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h1><h2 id="1-1-介绍"><a href="#1-1-介绍" class="headerlink" title="1.1. 介绍"></a>1.1. 介绍</h2><ul>
<li>Gin是一个golang的微框架，封装比较优雅，API友好，源码注释比较明确，具有快速灵活，容错方便等特点</li>
<li>对于golang而言，web框架的依赖要远比Python，Java之类的要小。自身的net/http足够简单，性能也非常不错</li>
<li>借助框架开发，不仅可以省去很多常用的封装带来的时间，也有助于团队的编码风格和形成规范</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>要安装Gin软件包，您需要安装Go并首先设置Go工作区。</p>
<p>1.首先需要安装Go（需要1.10+版本），然后可以使用下面的Go命令安装Gin。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> get -u github.com/gin-gonic/gin</span><br></pre></td></tr></table></figure>
<p>2.将其导入您的代码中：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"github.com/gin-gonic/gin"</span></span><br></pre></td></tr></table></figure>
<p>3.（可选）导入net/http。例如，如果使用常量，则需要这样做http.StatusOK。</p>
<p>import “net/http”</p>
<h1 id="2、基本路由"><a href="#2、基本路由" class="headerlink" title="2、基本路由"></a>2、基本路由</h1><ul>
<li><p>gin 框架中采用的路由库是基于httprouter做的</p>
</li>
<li><p>地址为：<a href="https://github.com/julienschmidt/httprouter" target="_blank" rel="noopener">https://github.com/julienschmidt/httprouter</a></p>
</li>
</ul>
<p>后端请求同样分为：GET POST PUT</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"> </span><br><span class="line">import (</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line"> </span><br><span class="line">	&quot;github.com/gin-gonic/gin&quot;</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line">func main() &#123;</span><br><span class="line">	// 1.创建路由</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	// 2.绑定路由规则，执行的函数</span><br><span class="line">	// gin.Context，封装了request和response</span><br><span class="line">	r.GET(&quot;/&quot;, func(c *gin.Context) &#123;</span><br><span class="line">		c.String(http.StatusOK, &quot;hello world!!&quot;)</span><br><span class="line">	&#125;)</span><br><span class="line">	// post请求</span><br><span class="line">	r.POST(&quot;/post&quot;)</span><br><span class="line">	// put 请求</span><br><span class="line">	r.PUT(&quot;/put&quot;)</span><br><span class="line"> </span><br><span class="line">	// 3.监听端口，默认在8080</span><br><span class="line">	// Run(&quot;里面不指定端口号默认为8080&quot;)</span><br><span class="line">	r.Run(&quot;:8001&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/04/14/部署go-admin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/image01.jpg">
      <meta itemprop="name" content="zhengwuhao">
      <meta itemprop="description" content="stay hungry stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WuHao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/14/部署go-admin/" class="post-title-link" itemprop="url">部署go-admin</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-04-14 15:14:33 / 修改时间：18:50:45" itemprop="dateCreated datePublished" datetime="2024-04-14T15:14:33+08:00">2024-04-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="部署go-admin"><a href="#部署go-admin" class="headerlink" title="部署go-admin"></a>部署go-admin</h1><h2 id="nginx-配置"><a href="#nginx-配置" class="headerlink" title="nginx 配置"></a>nginx 配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name localhost;</span><br><span class="line">  # 配置前端静态文件目录</span><br><span class="line">  location / &#123;</span><br><span class="line">      index index.html index.htm;</span><br><span class="line">      root /home/go/src/go-admin/dist;</span><br><span class="line">      try_files $uri $uri/ /index.html;</span><br><span class="line">     &#125;</span><br><span class="line">  # 配置后台go服务api接口服务 代理到8000端口</span><br><span class="line">  location ~ ^/api/ &#123;</span><br><span class="line">      proxy_set_header   Host             $http_host;</span><br><span class="line">      proxy_set_header   X-Real-IP        $remote_addr;</span><br><span class="line">      proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line">      proxy_set_header   X-Forwarded-Proto  $scheme;</span><br><span class="line">      rewrite ^/goadminapi/(.*)$ /$1 break;</span><br><span class="line">      proxy_pass  http://127.0.0.1:8000;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">`nginx -t` //测试nginx配置是否正确</span><br><span class="line">`nginx -s reload` //重启nginx服务</span><br></pre></td></tr></table></figure>
<h2 id="Shell-脚本打包-go-服务"><a href="#Shell-脚本打包-go-服务" class="headerlink" title="Shell 脚本打包 go 服务"></a>Shell 脚本打包 go 服务</h2><p><strong>修改配置信息</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">database:</span><br><span class="line">   # 数据库类型 mysql, sqlite3, postgres, sqlserver</span><br><span class="line">   # sqlserver: sqlserver://用户名:密码@地址?database=数据库名</span><br><span class="line">   driver: mysql</span><br><span class="line">   # 数据库连接字符串 mysql 缺省信息 charset=utf8&amp;parseTime=True&amp;loc=Local&amp;timeout=1000ms</span><br><span class="line">   source: root:123456@tcp(127.0.0.1:3306)/go_admin_dev?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&amp;timeout=1000ms</span><br></pre></td></tr></table></figure>
<p><strong>打包命令</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 需要一行执行，同时需要看部署服务器是否为linux，是否是amd64还是arm</span><br><span class="line">SET CGO_ENABLED=0</span><br><span class="line">SET GOOS=linux</span><br><span class="line">SET GOARCH=amd64</span><br><span class="line">go build -o go-admin main.go</span><br></pre></td></tr></table></figure>
<p><strong>启动脚本</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">echo &quot;删除进程&quot;</span><br><span class="line">killall go-admin #杀死运行中的go-admin服务进程</span><br><span class="line">echo &quot;启动进程&quot;</span><br><span class="line">nohup ./go-admin server -c=config/settings.yml &gt;&gt; access.log 2&gt;&amp;1 &amp; #后台启动服务将日志写入access.log文件</span><br><span class="line">ps -aux | grep go-admin #查看运行用的进程</span><br></pre></td></tr></table></figure>
<p>上传配置</p>
<p>上传 config 配置到服务器上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2ze505h9bgsbp83ct28pZ go-admin]# tree</span><br><span class="line">.</span><br><span class="line">├── config</span><br><span class="line">│ ├── db.sql # 系统初始化配置不建议上传服务器</span><br><span class="line">│ ├── rbac_model.conf</span><br><span class="line">│ ├── READMEN.md</span><br><span class="line">│ ├── settings.dev.yml # 测试环境配置不建议上传服务器</span><br><span class="line">│ ├── settings.yml</span><br><span class="line">│ └── sqlite.sql # 系统初始化配置不建议上传服务器</span><br><span class="line">├── go-admin</span><br><span class="line">└── restart.sh</span><br></pre></td></tr></table></figure>
<p>启动服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2ze505h9bgsbp83ct28pZ go-admin]# ./restart.sh</span><br><span class="line">删除进程</span><br><span class="line">go-admin: 未找到进程</span><br><span class="line">启动进程</span><br><span class="line">root      4033  0.0  0.0  12324  1080 pts/0    R+   07:39   0:00 grep go-admin</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/04/13/goroutine/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/image01.jpg">
      <meta itemprop="name" content="zhengwuhao">
      <meta itemprop="description" content="stay hungry stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WuHao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/13/goroutine/" class="post-title-link" itemprop="url">goroutine</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-04-13 21:56:01" itemprop="dateCreated datePublished" datetime="2024-04-13T21:56:01+08:00">2024-04-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-14 18:49:44" itemprop="dateModified" datetime="2024-04-14T18:49:44+08:00">2024-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1、goroutine"><a href="#1、goroutine" class="headerlink" title="1、goroutine"></a>1、goroutine</h1><h2 id="协程并发"><a href="#协程并发" class="headerlink" title="协程并发"></a>协程并发</h2><p>协程：coroutine。也叫轻量级线程。</p>
<p>与传统的系统级线程和进程相比，协程最大的优势在于“轻量级”。可以轻松创建上万个而不会导致系统资源衰竭。而线程和进程通常很难超过1万个。这也是协程别称“轻量级线程”的原因。</p>
<p>一个线程中可以有任意多个协程，但某一时刻只能有一个协程在运行，多个协程分享该线程分配到的计算机资源。</p>
<h2 id="Go并发"><a href="#Go并发" class="headerlink" title="Go并发"></a>Go并发</h2><p>Go 在语言级别支持协程，叫goroutine。Go 语言标准库提供的所有系统调用操作（包括所有同步IO操作），都会出让CPU给其他goroutine。这让轻量级线程的切换管理不依赖于系统的线程和进程，也不需要依赖于CPU的核心数量。</p>
<p>Go语言为并发编程而内置的上层API基于顺序通信进程模型CSP(communicating sequential processes)。这就意味着显式锁都是可以避免的，因为Go通过相对安全的通道发送和接受数据以实现同步，这大大地简化了并发程序的编写。</p>
<p>Go语言中的并发程序主要使用两种手段来实现。goroutine和channel。</p>
<h2 id="什么是Goroutine"><a href="#什么是Goroutine" class="headerlink" title="什么是Goroutine"></a>什么是Goroutine</h2><p>oroutine是Go语言并行设计的核心，有人称之为go程。 Goroutine从量级上看很像协程，它比线程更小，十几个goroutine可能体现在底层就是五六个线程，Go语言内部帮你实现了这些goroutine之间的内存共享。执行goroutine只需极少的栈内存(大概是4~5KB)，当然会根据相应的数据伸缩。也正因为如此，可同时运行成千上万个并发任务。goroutine比thread更易用、更高效、更轻便。</p>
<p>一般情况下，一个普通计算机跑几十个线程就有点负载过大了，但是同样的机器却可以轻松地让成百上千个goroutine进行资源竞争。</p>
<h2 id="创建Goroutine"><a href="#创建Goroutine" class="headerlink" title="创建Goroutine"></a>创建Goroutine</h2><p>只需在函数调⽤语句前添加 go 关键字，就可创建并发执⾏单元。开发⼈员无需了解任何执⾏细节，调度器会自动将其安排到合适的系统线程上执行。</p>
<p>在并发编程中，我们通常想将一个过程切分成几块，然后让每个goroutine各自负责一块工作，当一个程序启动时，主函数在一个单独的goroutine中运行，我们叫它main goroutine。新的goroutine会用go语句来创建。而go语言的并发设计，让我们很轻松就可以达成这一目的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"> </span><br><span class="line">import (</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;time&quot;</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line">func newTask() &#123;</span><br><span class="line">    i := 0</span><br><span class="line">    for &#123;</span><br><span class="line">        i++</span><br><span class="line">        fmt.Printf(&quot;new goroutine: i = %d\n&quot;, i)</span><br><span class="line">        time.Sleep(1*time.Second) //延时1s</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">func main() &#123;</span><br><span class="line">    //创建一个 goroutine，启动另外一个任务</span><br><span class="line">    go newTask()</span><br><span class="line">    i := 0</span><br><span class="line">    //main goroutine 循环打印</span><br><span class="line">    for &#123;</span><br><span class="line">        i++</span><br><span class="line">        fmt.Printf(&quot;main goroutine: i = %d\n&quot;, i)</span><br><span class="line">        time.Sleep(1 * time.Second) //延时1s</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Goroutine特性"><a href="#Goroutine特性" class="headerlink" title="Goroutine特性"></a>Goroutine特性</h2><p>主goroutine退出后，其它的工作goroutine也会自动退出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"> </span><br><span class="line">import (</span><br><span class="line">&quot;fmt&quot;</span><br><span class="line">&quot;time&quot;</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line">func newTask() &#123;</span><br><span class="line">    i := 0</span><br><span class="line">    for &#123;</span><br><span class="line">        i++</span><br><span class="line">        fmt.Printf(&quot;new goroutine: i = %d\n&quot;, i)</span><br><span class="line">        time.Sleep(1 * time.Second) //延时1s</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">func main() &#123;</span><br><span class="line">    //创建一个 goroutine，启动另外一个任务</span><br><span class="line">    go newTask()</span><br><span class="line"> </span><br><span class="line">    fmt.Println(&quot;main goroutine exit&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Goexit函数"><a href="#Goexit函数" class="headerlink" title="Goexit函数"></a>Goexit函数</h2><p>调用 runtime.Goexit() 将立即终止当前 goroutine 执⾏，调度器确保所有已注册 defer 延迟调用被执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"> </span><br><span class="line">import (</span><br><span class="line">&quot;fmt&quot;</span><br><span class="line">&quot;runtime&quot;</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line">func main() &#123;</span><br><span class="line">    go func() &#123;</span><br><span class="line">        defer fmt.Println(&quot;A.defer&quot;)</span><br><span class="line"> </span><br><span class="line">        func() &#123;</span><br><span class="line">            defer fmt.Println(&quot;B.defer&quot;)</span><br><span class="line">            runtime.Goexit() // 终止当前 goroutine, import &quot;runtime&quot;</span><br><span class="line">            fmt.Println(&quot;B&quot;) // 不会执行</span><br><span class="line">        &#125;()</span><br><span class="line"> </span><br><span class="line">        fmt.Println(&quot;A&quot;) // 不会执行</span><br><span class="line">    &#125;()       //不要忘记()</span><br><span class="line"> </span><br><span class="line">    //死循环，目的不让主goroutine结束</span><br><span class="line">    for &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2、channel"><a href="#2、channel" class="headerlink" title="2、channel"></a>2、channel</h2><p>channel是Go语言中的一个核心类型，可以把它看成管道。并发核心单元通过它就可以发送或者接收数据进行通讯，这在一定程度上又进一步降低了编程的难度。</p>
<p>channel是一个数据类型，主要用来解决go程的同步问题以及go程之间数据共享（数据传递）的问题。</p>
<p>goroutine运行在相同的地址空间，因此访问共享内存必须做好同步。goroutine 奉行通过通信来共享内存，而不是共享内存来通信。</p>
<p>引⽤类型 channel可用于多个 goroutine 通讯。其内部实现了同步，确保并发安全。</p>
<p>定义channel变量</p>
<p>和map类似，channel也一个对应make创建的底层数据结构的引用。</p>
<p>当我们复制一个channel或用于函数参数传递时，我们只是拷贝了一个channel引用，因此调用者和被调用者将引用同一个channel对象。和其它的引用类型一样，channel的零值也是nil。</p>
<p>定义一个channel时，也需要定义发送到channel的值的类型。channel可以使用内置的make()函数来创建：</p>
<p>chan是创建channel所需使用的关键字。Type 代表指定channel收发数据的类型。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make(chan Type)  //等价于make(chan Type, 0)</span><br><span class="line">make(chan Type, capacity)</span><br></pre></td></tr></table></figure>
<p><strong>无缓冲的channel</strong></p>
<p>无缓冲的通道（unbuffered channel）是指在接收前没有能力保存任何数据值的通道。</p>
<p>这种类型的通道要求发送goroutine和接收goroutine同时准备好，才能完成发送和接收操作。否则，通道会导致先执行发送或接收操作的 goroutine 阻塞等待。</p>
<p>这种对通道进行发送和接收的交互行为本身就是同步的。其中任意一个操作都无法离开另一个操作单独存在。</p>
<p>阻塞：由于某种原因数据没有到达，当前go程（线程）持续处于等待状态，直到条件满足，才解除阻塞。</p>
<p>同步：在两个或多个go程（线程）间，保持数据内容一致性的机制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"> </span><br><span class="line">import (</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;time&quot;</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line">func main() &#123;</span><br><span class="line">    c := make(chan int, 0) //创建无缓冲的通道 c </span><br><span class="line"> </span><br><span class="line">    //内置函数 len 返回未被读取的缓冲元素数量，cap 返回缓冲区大小</span><br><span class="line">    fmt.Printf(&quot;len(c)=%d, cap(c)=%d\n&quot;, len(c), cap(c))</span><br><span class="line"> </span><br><span class="line">    go func() &#123;</span><br><span class="line">        defer fmt.Println(&quot;子go程结束&quot;)</span><br><span class="line"> </span><br><span class="line">        for i := 0; i &lt; 3; i++ &#123;</span><br><span class="line">            c &lt;- i</span><br><span class="line">            fmt.Printf(&quot;子go程正在运行[%d]: len(c)=%d, cap(c)=%d\n&quot;, i, len(c), cap(c))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"> </span><br><span class="line">    time.Sleep(2 * time.Second) //延时2s</span><br><span class="line"> </span><br><span class="line">    for i := 0; i &lt; 3; i++ &#123;</span><br><span class="line">        num := &lt;-c //从c中接收数据，并赋值给num</span><br><span class="line">        fmt.Println(&quot;num = &quot;, num)</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    fmt.Println(&quot;main进程结束&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>有缓冲的channel</strong></p>
<p>有缓冲的通道（buffered channel）是一种在被接收前能存储一个或者多个数据值的通道。</p>
<p>这种类型的通道并不强制要求 goroutine 之间必须同时完成发送和接收。通道会阻塞发送和接收动作的条件也不同。</p>
<p>只有通道中没有要接收的值时，接收动作才会阻塞。</p>
<p>只有通道没有可用缓冲区容纳被发送的值时，发送动作才会阻塞。</p>
<p>这导致有缓冲的通道和无缓冲的通道之间的一个很大的不同：无缓冲的通道保证进行发送和接收的 goroutine 会在同一时间进行数据交换；有缓冲的通道没有这种保证。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">func main() &#123;</span><br><span class="line">    c := make(chan int, 3) //带缓冲的通道</span><br><span class="line"> </span><br><span class="line">    //内置函数 len 返回未被读取的缓冲元素数量， cap 返回缓冲区大小</span><br><span class="line">    fmt.Printf(&quot;len(c)=%d, cap(c)=%d\n&quot;, len(c), cap(c))</span><br><span class="line"> </span><br><span class="line">    go func() &#123;</span><br><span class="line">        defer fmt.Println(&quot;子go程结束&quot;)</span><br><span class="line"> </span><br><span class="line">        for i := 0; i &lt; 3; i++ &#123;</span><br><span class="line">            c &lt;- i</span><br><span class="line">            fmt.Printf(&quot;子go程正在运行[%d]: len(c)=%d, cap(c)=%d\n&quot;, i, len(c), cap(c))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"> </span><br><span class="line">    time.Sleep(2 * time.Second) //延时2s</span><br><span class="line">    for i := 0; i &lt; 3; i++ &#123;</span><br><span class="line">        num := &lt;-c //从c中接收数据，并赋值给num</span><br><span class="line">        fmt.Println(&quot;num = &quot;, num)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(&quot;main进程结束&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3、Select"><a href="#3、Select" class="headerlink" title="3、Select"></a>3、Select</h2><p>select作用</p>
<p>Go里面提供了一个关键字select，通过select可以监听channel上的数据流动。</p>
<p>有时候我们希望能够借助channel发送或接收数据，并避免因为发送或者接收导致的阻塞，尤其是当channel没有准备好写或者读时。select语句就可以实现这样的功能。</p>
<p>select的用法与switch语言非常类似，由select开始一个新的选择块，每个选择条件由case语句来描述。</p>
<p>与switch语句相比，select有比较多的限制，其中最大的一条限制就是每个case语句里必须是一个IO操作，大致的结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select &#123;</span><br><span class="line">case &lt;- chan1:</span><br><span class="line">    // 如果chan1成功读到数据，则进行该case处理语句</span><br><span class="line">case chan2 &lt;- 1:</span><br><span class="line">    // 如果成功向chan2写入数据，则进行该case处理语句</span><br><span class="line">default:</span><br><span class="line">    // 如果上面都没有成功，则进入default处理流程</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在一个select语句中，Go语言会按顺序从头至尾评估每一个发送和接收的语句。</p>
<p>如果其中的任意一语句可以继续执行(即没有被阻塞)，那么就从那些可以执行的语句中任意选择一条来使用。</p>
<p>如果没有任意一条语句可以执行(即所有的通道都被阻塞)，那么有两种可能的情况：</p>
<p>l 如果给出了default语句，那么就会执行default语句，同时程序的执行会从select语句后的语句中恢复。</p>
<p>l 如果没有default语句，那么select语句将被阻塞，直到至少有一个通信可以进行下去。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"> </span><br><span class="line">import (</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line">func fibonacci(c, quit chan int) &#123;</span><br><span class="line">    x, y := 1, 1</span><br><span class="line">    for &#123;</span><br><span class="line">        select &#123;</span><br><span class="line">        case c &lt;- x:</span><br><span class="line">            x, y = y, x+y</span><br><span class="line">        case &lt;-quit:</span><br><span class="line">            fmt.Println(&quot;quit&quot;)</span><br><span class="line">            return</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">func main() &#123;</span><br><span class="line">    c := make(chan int)</span><br><span class="line">    quit := make(chan int)</span><br><span class="line"> </span><br><span class="line">    go func() &#123;</span><br><span class="line">        for i := 0; i &lt; 6; i++ &#123;</span><br><span class="line">            fmt.Println(&lt;-c)</span><br><span class="line">        &#125;</span><br><span class="line">        quit &lt;- 0</span><br><span class="line">    &#125;()</span><br><span class="line"> </span><br><span class="line">    fibonacci(c, quit)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/04/13/slice和map/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/image01.jpg">
      <meta itemprop="name" content="zhengwuhao">
      <meta itemprop="description" content="stay hungry stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WuHao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/13/slice和map/" class="post-title-link" itemprop="url">slice</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-04-13 08:11:15" itemprop="dateCreated datePublished" datetime="2024-04-13T08:11:15+08:00">2024-04-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-14 18:47:55" itemprop="dateModified" datetime="2024-04-14T18:47:55+08:00">2024-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="slice"><a href="#slice" class="headerlink" title="slice"></a>slice</h1><p>o 语言切片是对数组的抽象。</p>
<p>Go 数组的长度不可改变，在特定场景中这样的集合就不太适用，Go中提供了一种灵活，功能强悍的内置类型切片(“动态数组”),与数组相比切片的长度是不固定的，可以追加元素，在追加时可能使切片的容量增大。</p>
<h2 id="定义切片"><a href="#定义切片" class="headerlink" title="定义切片"></a>定义切片</h2><p>切片初始化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s :=[] int &#123;1,2,3 &#125;</span><br></pre></td></tr></table></figure>
<p>直接初始化切片，[]表示是切片类型，{1,2,3}初始化值依次是1,2,3.其cap=len=3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s := arr[:]</span><br></pre></td></tr></table></figure>
<p>初始化切片s,是数组arr的引用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s := arr[startIndex:endIndex]</span><br></pre></td></tr></table></figure>
<h2 id="len-和-cap-函数"><a href="#len-和-cap-函数" class="headerlink" title="len() 和 cap() 函数"></a>len() 和 cap() 函数</h2><p>切片是可索引的，并且可以由 len() 方法获取长度。</p>
<p>切片提供了计算容量的方法 cap() 可以测量切片最长可以达到多少。</p>
<p>以下为具体实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">   var numbers = make([]int,3,5)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   printSlice(numbers)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func printSlice(x []int)&#123;</span><br><span class="line">   fmt.Printf(&quot;len=%d cap=%d slice=%v\n&quot;,len(x),cap(x),x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="append-和-copy-函数"><a href="#append-和-copy-函数" class="headerlink" title="append() 和 copy() 函数"></a>append() 和 copy() 函数</h2><p>如果想增加切片的容量，我们必须创建一个新的更大的切片并把原分片的内容都拷贝过来。</p>
<p>下面的代码描述了从拷贝切片的 copy 方法和向切片追加新元素的 append 方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">   var numbers []int</span><br><span class="line">   printSlice(numbers)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   /* 允许追加空切片 */</span><br><span class="line">   numbers = append(numbers, 0)</span><br><span class="line">   printSlice(numbers)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   /* 向切片添加一个元素 */</span><br><span class="line">   numbers = append(numbers, 1)</span><br><span class="line">   printSlice(numbers)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   /* 同时添加多个元素 */</span><br><span class="line">   numbers = append(numbers, 2,3,4)</span><br><span class="line">   printSlice(numbers)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   /* 创建切片 numbers1 是之前切片的两倍容量*/</span><br><span class="line">   numbers1 := make([]int, len(numbers), (cap(numbers))*2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   /* 拷贝 numbers 的内容到 numbers1 */</span><br><span class="line">   copy(numbers1,numbers)</span><br><span class="line">   printSlice(numbers1)   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func printSlice(x []int)&#123;</span><br><span class="line">   fmt.Printf(&quot;len=%d cap=%d slice=%v\n&quot;,len(x),cap(x),x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="map"><a href="#map" class="headerlink" title="map"></a>map</h1><p>map和slice类似，只不过是数据结构不同，下面是map的一些声明方式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line">import (</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">    //第一种声明</span><br><span class="line">    var test1 map[string]string</span><br><span class="line">    //在使用map前，需要先make，make的作用就是给map分配数据空间</span><br><span class="line">    test1 = make(map[string]string, 10) </span><br><span class="line">    test1[&quot;one&quot;] = &quot;php&quot;</span><br><span class="line">    test1[&quot;two&quot;] = &quot;golang&quot;</span><br><span class="line">    test1[&quot;three&quot;] = &quot;java&quot;</span><br><span class="line">    fmt.Println(test1) //map[two:golang three:java one:php]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //第二种声明</span><br><span class="line">    test2 := make(map[string]string)</span><br><span class="line">    test2[&quot;one&quot;] = &quot;php&quot;</span><br><span class="line">    test2[&quot;two&quot;] = &quot;golang&quot;</span><br><span class="line">    test2[&quot;three&quot;] = &quot;java&quot;</span><br><span class="line">    fmt.Println(test2) //map[one:php two:golang three:java]</span><br><span class="line"></span><br><span class="line">    //第三种声明</span><br><span class="line">    test3 := map[string]string&#123;</span><br><span class="line">        &quot;one&quot; : &quot;php&quot;,</span><br><span class="line">        &quot;two&quot; : &quot;golang&quot;,</span><br><span class="line">        &quot;three&quot; : &quot;java&quot;,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(test3) //map[one:php two:golang three:java]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    language := make(map[string]map[string]string)</span><br><span class="line">    language[&quot;php&quot;] = make(map[string]string, 2)</span><br><span class="line">    language[&quot;php&quot;][&quot;id&quot;] = &quot;1&quot;</span><br><span class="line">    language[&quot;php&quot;][&quot;desc&quot;] = &quot;php是世界上最美的语言&quot;</span><br><span class="line">    language[&quot;golang&quot;] = make(map[string]string, 2)</span><br><span class="line">    language[&quot;golang&quot;][&quot;id&quot;] = &quot;2&quot;</span><br><span class="line">    language[&quot;golang&quot;][&quot;desc&quot;] = &quot;golang抗并发非常good&quot;</span><br><span class="line">    </span><br><span class="line">    fmt.Println(language) //map[php:map[id:1 desc:php是世界上最美的语言] golang:map[id:2 desc:golang抗并发非常good]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //增删改查</span><br><span class="line">    // val, key := language[&quot;php&quot;]  //查找是否有php这个子元素</span><br><span class="line">    // if key &#123;</span><br><span class="line">    //     fmt.Printf(&quot;%v&quot;, val)</span><br><span class="line">    // &#125; else &#123;</span><br><span class="line">    //     fmt.Printf(&quot;no&quot;);</span><br><span class="line">    // &#125;</span><br><span class="line"></span><br><span class="line">    //language[&quot;php&quot;][&quot;id&quot;] = &quot;3&quot; //修改了php子元素的id值</span><br><span class="line">    //language[&quot;php&quot;][&quot;nickname&quot;] = &quot;啪啪啪&quot; //增加php元素里的nickname值</span><br><span class="line">    //delete(language, &quot;php&quot;)  //删除了php子元素</span><br><span class="line">    fmt.Println(language)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2023/07/05/分布式事务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/image01.jpg">
      <meta itemprop="name" content="zhengwuhao">
      <meta itemprop="description" content="stay hungry stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WuHao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/07/05/分布式事务/" class="post-title-link" itemprop="url">分布式事务</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-07-05 13:48:28" itemprop="dateCreated datePublished" datetime="2023-07-05T13:48:28+08:00">2023-07-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-14 19:13:16" itemprop="dateModified" datetime="2024-04-14T19:13:16+08:00">2024-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/分布式/" itemprop="url" rel="index"><span itemprop="name">分布式</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="本地事务"><a href="#本地事务" class="headerlink" title="本地事务"></a>本地事务</h2><p>只在一个数据库操作，不会有分布式事务问题</p>
<p>特性（ACID）：</p>
<ol>
<li>原子性：一系列操作不可拆分，要么同时成功，要么同时失败</li>
<li>一致性：数据在事务的前后，业务整体一致</li>
<li>隔离性：事务之间相互隔离</li>
<li>永久性：一旦事务成功，数据一定会落盘数据库</li>
</ol>
<h3 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h3><ol>
<li>读未提交（会有脏读问题）</li>
<li>读已提交 （不可重复读）</li>
<li>可重复读</li>
<li>串行化</li>
</ol>
<h3 id="事务传播行为"><a href="#事务传播行为" class="headerlink" title="事务传播行为"></a>事务传播行为</h3><p>REQUIRED<br>REQUIRED_NEW</p>
<h3 id="事务失效问题"><a href="#事务失效问题" class="headerlink" title="事务失效问题"></a>事务失效问题</h3><p>同个service方法调用，绕过了代理对象</p>
<h2 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h2><ol>
<li>远程服务失败：远程服务其实成功了，由于网络故等没有返回，导致的订单回滚，库存却扣减</li>
<li>远程服务执行完成，下面的其他方法出现问题，导致已执行的远程请求，肯定不能回滚</li>
</ol>
<h3 id="CAP定理"><a href="#CAP定理" class="headerlink" title="CAP定理"></a>CAP定理</h3><p>C: Consistency 一致性<br>A: Avaliavlity可用性<br>P: Partition tolerance分区容错性</p>
<p>不可能同时满足，只能CP或AP</p>
<h3 id="raft"><a href="#raft" class="headerlink" title="raft"></a>raft</h3><h3 id="BASE理论"><a href="#BASE理论" class="headerlink" title="BASE理论"></a>BASE理论</h3><p>BASE 是 BASE Avaliable(基本可用)，Soft state(软状态) 和 Eventually consistent(最终一致性)三个短语的简写</p>
<h2 id="一致性协议"><a href="#一致性协议" class="headerlink" title="一致性协议"></a>一致性协议</h2><h3 id="2PC"><a href="#2PC" class="headerlink" title="2PC"></a>2PC</h3><p>两段提交顾名思义就是要进行两个阶段的提交：第一阶段，准备阶段(投票阶段) ；第二阶段，提交阶段（执行阶段）。</p>
<h2 id="TCC"><a href="#TCC" class="headerlink" title="TCC"></a>TCC</h2><p>TCC（Try-Confirm-Cancel）又被称补偿事务，TCC与2PC的思想很相似，事务处理流程也很相似，但2PC 是应用于在DB层面，TCC则可以理解为在应用层面的2PC，是需要我们编写业务逻辑来实现。</p>
<p>TCC它的核心思想是：”针对每个操作都要注册一个与其对应的确认（Try）和补偿（Cancel）”。</p>
<p>还拿下单扣库存解释下它的三个操作：</p>
<p>Try阶段：</p>
<p>下单时通过Try操作去扣除库存预留资源。</p>
<p>Confirm阶段：</p>
<p>确认执行业务操作，在只预留的资源基础上，发起购买请求。</p>
<p>Cancel阶段：</p>
<p>只要涉及到的相关业务中，有一个业务方预留资源未成功，则取消所有业务资源的预留请求。</p>
<h2 id="seata"><a href="#seata" class="headerlink" title="seata"></a>seata</h2><p>默认是AT模式</p>
<h3 id="AT模式和XA模式区别"><a href="#AT模式和XA模式区别" class="headerlink" title="AT模式和XA模式区别"></a>AT模式和XA模式区别</h3><p>XA模式一阶段不提交事务，锁定资源；AT模式一阶段直接提交，不锁定资源。<br>XA模式依赖数据库机制实现回滚；AT模式利用数据快照实现数据回滚。<br>XA模式强一致；AT模式最终一致</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2023/01/15/hashmap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/image01.jpg">
      <meta itemprop="name" content="zhengwuhao">
      <meta itemprop="description" content="stay hungry stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WuHao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/15/hashmap/" class="post-title-link" itemprop="url">HashMap原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-15 13:55:15" itemprop="dateCreated datePublished" datetime="2023-01-15T13:55:15+08:00">2023-01-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-14 11:05:30" itemprop="dateModified" datetime="2024-04-14T11:05:30+08:00">2024-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java基础/" itemprop="url" rel="index"><span itemprop="name">java基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h1><h1 id="HashMap-jdk1-7"><a href="#HashMap-jdk1-7" class="headerlink" title="HashMap(jdk1.7)"></a>HashMap(jdk1.7)</h1><p><strong>数据结构</strong>:数组+链表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * The default initial capacity - MUST be a power of two.</span><br><span class="line">     * table(数组)默认初始容量16，必须是2的n次方</span><br><span class="line">     */</span><br><span class="line">    static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * The maximum capacity, used if a higher value is implicitly specified</span><br><span class="line">     * by either of the constructors with arguments.</span><br><span class="line">     * MUST be a power of two &lt;= 1&lt;&lt;30.</span><br><span class="line">     * table(数组)最大容量2的32次方</span><br><span class="line">     */</span><br><span class="line">    static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * The load factor used when none specified in constructor.</span><br><span class="line">     * 默认负载因子0.75</span><br><span class="line">     */</span><br><span class="line">    static final float DEFAULT_LOAD_FACTOR = 0.75f;</span><br></pre></td></tr></table></figure>
<p>懒加载方式，不在构造方法中创建容量，只在第一次put操作中创建。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public V put(K key, V value) &#123;</span><br><span class="line">        //若为空数组,则初始化数组，默认为16</span><br><span class="line">        if (table == EMPTY_TABLE) &#123;</span><br><span class="line">            inflateTable(threshold);</span><br><span class="line">        &#125;</span><br><span class="line">        //当key为null是,存储位置为table[0]或table[0]的冲突链上</span><br><span class="line">        if (key == null)</span><br><span class="line">            return putForNullKey(value);</span><br><span class="line">        //计算hash值</span><br><span class="line">        int hash = hash(key);</span><br><span class="line">        //根据hash值,定位在数组中的位置</span><br><span class="line">        int i = indexFor(hash, table.length);</span><br><span class="line">        //循环查找该数组中的链表，查找到，则覆盖，并返回旧值</span><br><span class="line">        for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) &#123;</span><br><span class="line">            Object k;</span><br><span class="line">            if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123;</span><br><span class="line">                V oldValue = e.value;</span><br><span class="line">                e.value = value;</span><br><span class="line">                e.recordAccess(this);</span><br><span class="line">                return oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        //保证并发访问时，若HashMap内部结构发生变化，快速响应失败</span><br><span class="line">        modCount++;</span><br><span class="line">        //新增一个entry</span><br><span class="line">        addEntry(hash, key, value, i);</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//膨胀数组</span><br><span class="line">private void inflateTable(int toSize) &#123;</span><br><span class="line">        //找到一个大于等于的最接近toSize的二次幂</span><br><span class="line">        // Find a power of 2 &gt;= toSize</span><br><span class="line">        int capacity = roundUpToPowerOf2(toSize);</span><br><span class="line"></span><br><span class="line">        threshold = (int) Math.min(capacity * loadFactor, MAXIMUM_CAPACITY + 1);</span><br><span class="line">        table = new Entry[capacity];</span><br><span class="line">        initHashSeedAsNeeded(capacity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">private static int roundUpToPowerOf2(int number) &#123;</span><br><span class="line">    // assert number &gt;= 0 : &quot;number must be non-negative&quot;;</span><br><span class="line">    return number &gt;= MAXIMUM_CAPACITY</span><br><span class="line">            ? MAXIMUM_CAPACITY</span><br><span class="line">            : (number &gt; 1) ? Integer.highestOneBit((number - 1) &lt;&lt; 1) : 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">final int hash(Object k) &#123;</span><br><span class="line">        int h = hashSeed;</span><br><span class="line">        if (0 != h &amp;&amp; k instanceof String) &#123;</span><br><span class="line">            return sun.misc.Hashing.stringHash32((String) k);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        h ^= k.hashCode();</span><br><span class="line"></span><br><span class="line">        // This function ensures that hashCodes that differ only by</span><br><span class="line">        // constant multiples at each bit position have a bounded</span><br><span class="line">        // number of collisions (approximately 8 at default load factor).</span><br><span class="line">        h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12);</span><br><span class="line">        return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//通过hash值定位到数组位置,哈希值和数组长度&amp;运算。</span><br><span class="line">static int indexFor(int h, int length) &#123;</span><br><span class="line">    // assert Integer.bitCount(length) == 1 : &quot;length must be a non-zero power of 2&quot;;</span><br><span class="line">    return h &amp; (length-1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="hashmap为什么数组长度是2的幂次方"><a href="#hashmap为什么数组长度是2的幂次方" class="headerlink" title="hashmap为什么数组长度是2的幂次方"></a>hashmap为什么数组长度是2的幂次方</h2><p>为了能让HashMap存取高效，尽量减少碰撞，也就是要尽量把数据分配均匀。首先想到的是取余运算即 hash%length，取余操作中如果除数是2的幂次则等价于其除数减一的与操作，也就是说hash%length=hash&amp;(length-1)，对于%运算来说，&amp;运算效率更高，故解释了hashmap为什么长度是的n次幂</p>
<p><strong>为什么&amp;效率更高</strong></p>
<p>因为位运算直接对内存数据进行操作，不需要转成十进制，所以位运算要比取模运算的效率更高</p>
<p><strong>当length为2的N次方的时候，数据分布均匀，减少冲突</strong></p>
<p>2的n次方-1转换成二进制，值全是1，保证了数据分布均匀；若是奇数，最后一位永远是0，这样，空间的减少会导致碰撞几率的进一步增加，从而就会导致查询速度慢。</p>
<h2 id="hashmap多线程死循环问题"><a href="#hashmap多线程死循环问题" class="headerlink" title="hashmap多线程死循环问题"></a>hashmap多线程死循环问题</h2><p>在jdk 1.7 中hashmap扩容rehash时，使用头插法，多线程操作可能导致形成循环链表，之后再进件get操作时可能引发死循环，造成cpu 100%。在jdk1.8中，把头插法修改为尾插法，修复了该问题。</p>
<p><a href="https://coolshell.cn/articles/9606.html" target="_blank" rel="noopener">具体步骤</a></p>
<h2 id="hashmap底层结构"><a href="#hashmap底层结构" class="headerlink" title="hashmap底层结构"></a>hashmap底层结构</h2><p>jdk7：数组+链表</p>
<p>jdk8: 数组+链表或红黑树</p>
<p><strong>为什么使用红黑树</strong></p>
<p>jdk7中，可能由于hash碰撞导致链表会很长，造成查询效率会低；在jdk8中，当链表长度大于等于8且元素个数大于64时会转换成红黑树，查询效率由O(n)提升到O(logn)</p>
<h2 id="hashmap重要参数"><a href="#hashmap重要参数" class="headerlink" title="hashmap重要参数"></a>hashmap重要参数</h2><p>初始容量: 创建哈希表(数组)时桶的数量，默认为 16</p>
<p>负载因子: 临界值 = 数组容量*负载因子，当超过临界值时，会自动扩容，还需要对原来元素进行rehash，分配到不同桶中。</p>
<h2 id="hash算法"><a href="#hash算法" class="headerlink" title="hash算法"></a>hash算法</h2><p>jdk8: (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16) ，相当于hashcode的高16位和低16位异或运算</p>
<p>可以将高低位二进制特征混合起来；异或运算能更好的保留各部分的特征</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2022/06/05/P转M(0605微课向上管理)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/image01.jpg">
      <meta itemprop="name" content="zhengwuhao">
      <meta itemprop="description" content="stay hungry stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WuHao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/05/P转M(0605微课向上管理)/" class="post-title-link" itemprop="url">P转M(0605微课向上管理)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-06-05 19:11:11" itemprop="dateCreated datePublished" datetime="2022-06-05T19:11:11+08:00">2022-06-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-14 10:58:47" itemprop="dateModified" datetime="2024-04-14T10:58:47+08:00">2024-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/P转M/" itemprop="url" rel="index"><span itemprop="name">P转M</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="激励你的领导"><a href="#激励你的领导" class="headerlink" title="激励你的领导"></a>激励你的领导</h1><p>领导也需要”被看见”，反馈即激励</p>
<h2 id="典型话术"><a href="#典型话术" class="headerlink" title="典型话术"></a>典型话术</h2><p>上次您支出的xx问题，我最近做了一些尝试/落实，我有xx发现/收获</p>
<h1 id="向你的领导保持战略透明度"><a href="#向你的领导保持战略透明度" class="headerlink" title="向你的领导保持战略透明度"></a>向你的领导保持战略透明度</h1><p>领导也需要安全感</p>
<p>为什么领导喜欢任用前秘书</p>
<p>主动提高自己的透明度，主动降低别人跟你合作的”心理成本”</p>
<h2 id="典型话术-1"><a href="#典型话术-1" class="headerlink" title="典型话术"></a>典型话术</h2><p>有个事儿一直没有机会说，其实，我曾经有段时间特别怕向您汇报，因为xxx</p>
<h2 id="典型话术-2"><a href="#典型话术-2" class="headerlink" title="典型话术"></a>典型话术</h2><p>昨天您派我去办的那个事儿，结果是xxx，不过过程中有个情况拿不准，可能需要跟您同步下</p>
<h1 id="闭环能力"><a href="#闭环能力" class="headerlink" title="闭环能力"></a>闭环能力</h1><p>不是做完了才叫闭环，闭环是管理对方的期待</p>
<p>我们通常以为，闭环是为了给别人一个交代。其实不是，它甚至也不是为了给自己一个交代，而是给未来一个交代。</p>
<h1 id="成为你领导的外挂"><a href="#成为你领导的外挂" class="headerlink" title="成为你领导的外挂"></a>成为你领导的外挂</h1><p>把自己作为方法，好的领导关系是协同进化，承包对方能力圈的一部分。</p>
<h2 id="典型话术-3"><a href="#典型话术-3" class="headerlink" title="典型话术"></a>典型话术</h2><p>这块工作您就交给我吧，我负全责，过程中有问题我随时向您汇报。</p>
<h2 id="向上沟通隐藏技能"><a href="#向上沟通隐藏技能" class="headerlink" title="向上沟通隐藏技能"></a>向上沟通隐藏技能</h2><p>发展同盟军，怎么和上级身边的人相处。</p>
<p>把他们当成专业人士来尊重</p>
<p>把领导还原成人，渴望被看见，渴望被认同。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2022/05/28/P转M(0528微课)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/image01.jpg">
      <meta itemprop="name" content="zhengwuhao">
      <meta itemprop="description" content="stay hungry stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WuHao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/28/P转M(0528微课)/" class="post-title-link" itemprop="url">P转M(0528微课——目标分解与落地)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-28 14:56:06" itemprop="dateCreated datePublished" datetime="2022-05-28T14:56:06+08:00">2022-05-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-04-14 10:58:23" itemprop="dateModified" datetime="2024-04-14T10:58:23+08:00">2024-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/P转M/" itemprop="url" rel="index"><span itemprop="name">P转M</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="如何管事之目标分解与落地"><a href="#如何管事之目标分解与落地" class="headerlink" title="如何管事之目标分解与落地"></a>如何管事之目标分解与落地</h1><h2 id="定量目标的分析与落地"><a href="#定量目标的分析与落地" class="headerlink" title="定量目标的分析与落地"></a>定量目标的分析与落地</h2><p>SMART原则</p>
<p>目标-行动措施-解决方案-列计划-做计划</p>
<h2 id="定性目标的分析与目标"><a href="#定性目标的分析与目标" class="headerlink" title="定性目标的分析与目标"></a>定性目标的分析与目标</h2><p>不能很好量化的。</p>
<p>关键影响因素-&gt;关键评价指标-&gt;关键行动措施。</p>
<h1 id="工作委派与授权"><a href="#工作委派与授权" class="headerlink" title="工作委派与授权"></a>工作委派与授权</h1><h2 id="问题-工作委派的误区和真相"><a href="#问题-工作委派的误区和真相" class="headerlink" title="问题 工作委派的误区和真相"></a>问题 工作委派的误区和真相</h2><p>误区：</p>
<ol>
<li>保姆式委派</li>
<li>派活式委派</li>
</ol>
<p>真相：</p>
<ol>
<li>认识匹配</li>
<li>意愿能力</li>
</ol>
<h2 id="团队授权的误区和真相"><a href="#团队授权的误区和真相" class="headerlink" title="团队授权的误区和真相"></a>团队授权的误区和真相</h2><p>误区：</p>
<ol>
<li>放任不管</li>
<li>只要结果</li>
</ol>
<p>真相：</p>
<ol>
<li>过程沟通</li>
<li>节点检查</li>
</ol>
<h2 id="原则-工作委派和授权的应用原则"><a href="#原则-工作委派和授权的应用原则" class="headerlink" title="原则 工作委派和授权的应用原则"></a>原则 工作委派和授权的应用原则</h2><ol>
<li>不要鞭打快牛 （不要一直让一个人做）</li>
<li>不要光凭印象</li>
<li>不要忘记复盘</li>
</ol>
<h1 id="如何管事之过程跟踪与反馈"><a href="#如何管事之过程跟踪与反馈" class="headerlink" title="如何管事之过程跟踪与反馈"></a>如何管事之过程跟踪与反馈</h1><h2 id="过程跟踪的节点管理策略"><a href="#过程跟踪的节点管理策略" class="headerlink" title="过程跟踪的节点管理策略"></a>过程跟踪的节点管理策略</h2><ol>
<li>划清路线路</li>
<li>定好节点表</li>
<li>开好节点会</li>
</ol>
<h2 id="过程管控中的典型障碍与解决方案"><a href="#过程管控中的典型障碍与解决方案" class="headerlink" title="过程管控中的典型障碍与解决方案"></a>过程管控中的典型障碍与解决方案</h2><ol>
<li>计划有变-及时沟通</li>
<li>意外发生-事前预案</li>
<li>责任扯皮-定义标准</li>
</ol>
<h2 id="过程跟踪与管控的应用原则"><a href="#过程跟踪与管控的应用原则" class="headerlink" title="过程跟踪与管控的应用原则"></a>过程跟踪与管控的应用原则</h2><ol>
<li>责任人主动反馈</li>
<li>未完成信号预警</li>
<li>有问题马上改进</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zhengwuhao"
      src="/image/image01.jpg">
  <p class="site-author-name" itemprop="name">zhengwuhao</p>
  <div class="site-description" itemprop="description">stay hungry stay foolish</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhengwuhao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
